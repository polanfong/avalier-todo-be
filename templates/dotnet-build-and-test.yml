# File: templates/dotnet-build-and-test.yml

steps:

- task: UseDotNet@2
  displayName: 'Use dotnet sdk 3.x'
  inputs:
    version: 3.x
    includePreviewVersions: true

- task: DotNetCoreCLI@2
  inputs:
    command: build
    projects: 'src/*.sln'
    arguments: '--configuration Release' # Update this to match your need
  displayName: 'Building'

- task: WhiteSource Bolt@19
  #inputs: $(Build.SourcesDirectory)

- task: DotNetCoreCLI@2
  inputs:
    command: test
    projects: '**/*.Tests/*.csproj'
    arguments: '--configuration $(buildConfiguration) /p:CollectCoverage=true /p:CoverletOutputFormat=cobertura /p:CoverletOutput=$(Agent.TempDirectory)/Coverage/'
  displayName: 'Testing'

- task: PublishTestResults@2
  condition: succeededOrFailed()
  inputs:
    testRunner: XUnit
  displayName: 'Publish Test Results'

- task: PublishCodeCoverageResults@1
  inputs:
    codeCoverageTool: 'cobertura'
    summaryFileLocation: '$(Agent.TempDirectory)/Coverage/coverage.cobertura.xml'
  displayName: 'Publish Coverage Results'